<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IPv4 to IPv6 Converter (بهبود یافته)</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #1e293b;
        color: #e2e8f0;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 40px 20px;
    }

    h1 {
        color: #22c55e;
        margin-bottom: 20px;
        text-align: center;
    }

    .input-section {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
    }

    input[type="text"] {
        width: 250px;
        padding: 8px 12px;
        font-size: 16px;
        border-radius: 6px;
        border: none;
        margin-right: 10px;
        margin-bottom: 10px;
    }

    button {
        padding: 8px 16px;
        font-size: 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        color: white;
    }

    #generateBtn {
        background-color: #2563eb;
    }

    #copyBtn {
        background-color: #22c55e;
        margin-top: 15px;
    }

    .results-container {
        margin-top: 20px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        width: 450px;
    }

    .result-card {
        background-color: #0f172a;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #22c55e;
    }

    .result-card p {
        margin: 5px 0;
        word-break: break-all;
    }

    .label {
        color: #f97316;
        font-weight: bold;
    }

    .status {
        color: #64748b;
        font-size: 12px;
        font-style: italic;
    }

    .checkbox-container {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 10px;
    }

    /* Custom Toggle Switch */
    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 26px;
    }

    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #475569;
        transition: 0.3s;
        border-radius: 26px;
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 3px;
        bottom: 3px;
        background-color: #e2e8f0;
        transition: 0.3s;
        border-radius: 50%;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    input:checked + .slider {
        background: linear-gradient(45deg, #22c55e, #16a34a);
        box-shadow: 0 0 12px rgba(34, 197, 94, 0.3);
    }

    input:focus + .slider {
        box-shadow: 0 0 1px #22c55e;
    }

    input:checked + .slider:before {
        transform: translateX(24px);
        background-color: #ffffff;
        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    .toggle-label {
        font-size: 14px;
        color: #cbd5e1;
        font-weight: 500;
        user-select: none;
        cursor: pointer;
        transition: color 0.3s;
    }

    .toggle-label:hover {
        color: #22c55e;
    }

    #customPrefixInput {
        display: none;
        width: 200px;
        transition: all 0.3s ease;
        opacity: 0;
        transform: translateY(-10px);
    }

    #customPrefixInput.show {
        display: inline-block;
        opacity: 1;
        transform: translateY(0);
    }

    .warning {
        color: #fbbf24;
        font-size: 14px;
        margin-top: 5px;
    }
</style>
</head>
<body>

<h1>IPv4 to IPv6 Converter<br><small style="color: #64748b;">نسخه بهبود یافته</small></h1>

<div class="input-section">
    <div>
        <input type="text" id="ipv4Input" placeholder="Enter IPv4 (e.g., 192.0.2.128)">
        <button id="generateBtn">Generate</button>
    </div>

    <div class="checkbox-container">
        <label class="toggle-switch">
            <input type="checkbox" id="customPrefixCheckbox">
            <span class="slider"></span>
        </label>
        <label for="customPrefixCheckbox" class="toggle-label">Enable Custom Prefix</label>
        <input type="text" id="customPrefixInput" placeholder="Enter IPv6 prefix (e.g., 2001:db8)">
    </div>
</div>

<div class="results-container" id="results" style="display:none;">
    <div class="result-card">
        <p><span class="label">IPv4-mapped (decimal):</span> <span id="mappedDecimal"></span></p>
        <p class="status">✅ استاندارد RFC 4291 - پشتیبانی کامل</p>
    </div>

    <div class="result-card">
        <p><span class="label">IPv4-mapped (hex):</span> <span id="mappedHex"></span></p>
        <p class="status">✅ استاندارد RFC 4291 - فرمت hex</p>
    </div>

    <div class="result-card">
        <p><span class="label">IPv4-compatible:</span> <span id="compatible"></span></p>
        <p class="status">⚠️ منسوخ شده در RFC 4291</p>
    </div>

    <div class="result-card">
        <p><span class="label">6to4 Tunnel:</span> <span id="tunnel6to4"></span></p>
        <p class="status">✅ استاندارد RFC 3056</p>
    </div>

    <div class="result-card">
        <p><span class="label">Custom Prefix:</span> <span id="custom"></span></p>
        <p class="status">✅ فرمت سفارشی</p>
    </div>
</div>

<button id="copyBtn" style="display:none;">Copy All Results</button>

<script>
function validateIPv4(ip) {
    const octets = ip.split('.');
    if (octets.length !== 4) return false;
    
    return octets.every(octet => {
        const num = parseInt(octet, 10);
        return !isNaN(num) && num >= 0 && num <= 255 && octet === num.toString();
    });
}

function validateIPv6Prefix(prefix) {
    // Simple validation for IPv6 prefix
    const regex = /^[0-9a-fA-F:]{1,39}$/;
    return regex.test(prefix) && !prefix.endsWith(':');
}

function ipv4ToHex(ip) {
    return ip.split('.').map(n => parseInt(n, 10).toString(16).padStart(2, '0')).join('');
}

document.getElementById('customPrefixCheckbox').addEventListener('change', function() {
    const input = document.getElementById('customPrefixInput');
    
    if (this.checked) {
        input.classList.add('show');
        setTimeout(() => input.focus(), 300);
    } else {
        input.classList.remove('show');
        input.value = ''; // Clear input when disabled
    }
});

function generateIPv6() {
    const ipv4 = document.getElementById('ipv4Input').value.trim();
    
    if (!validateIPv4(ipv4)) {
        alert("لطفاً یک آدرس IPv4 معتبر وارد کنید!\nمثال: 192.0.2.128");
        return;
    }

    // IPv4-mapped (decimal format)
    const mappedDecimal = `::ffff:${ipv4}`;

    // IPv4-mapped (hex format)
    const hexPart = ipv4ToHex(ipv4);
    const mappedHex = `::ffff:${hexPart.slice(0,4)}:${hexPart.slice(4,8)}`;

    // IPv4-compatible (deprecated)
    const compatible = `::${ipv4}`;

    // 6to4 tunnel format
    const tunnel6to4 = `2002:${hexPart.slice(0,4)}:${hexPart.slice(4,8)}::`;

    // Custom Prefix
    let customPrefix = "2001:db8";
    if (document.getElementById('customPrefixCheckbox').checked) {
        const userPrefix = document.getElementById('customPrefixInput').value.trim();
        if (userPrefix) {
            if (validateIPv6Prefix(userPrefix)) {
                customPrefix = userPrefix;
            } else {
                alert("پیشوند IPv6 نامعتبر است!\nمثال معتبر: 2001:db8 یا fc00");
                return;
            }
        }
    }
    
    const custom = `${customPrefix}::${hexPart.slice(0,4)}:${hexPart.slice(4,8)}`;

    // Display results
    document.getElementById('mappedDecimal').textContent = mappedDecimal;
    document.getElementById('mappedHex').textContent = mappedHex;
    document.getElementById('compatible').textContent = compatible;
    document.getElementById('tunnel6to4').textContent = tunnel6to4;
    document.getElementById('custom').textContent = custom;

    document.getElementById('results').style.display = 'flex';
    document.getElementById('copyBtn').style.display = 'inline-block';
}

function copyAll() {
    const results = {
        'IPv4-mapped (decimal)': document.getElementById('mappedDecimal').textContent,
        'IPv4-mapped (hex)': document.getElementById('mappedHex').textContent,
        'IPv4-compatible': document.getElementById('compatible').textContent,
        '6to4 Tunnel': document.getElementById('tunnel6to4').textContent,
        'Custom Prefix': document.getElementById('custom').textContent
    };

    const textToCopy = Object.entries(results)
        .map(([key, value]) => `${key}: ${value}`)
        .join('\n');
    
    navigator.clipboard.writeText(textToCopy).then(() => {
        alert("تمام فرمت‌های IPv6 کپی شدند! ✅");
    }).catch(() => {
        // Fallback for older browsers
        const textarea = document.createElement('textarea');
        textarea.value = textToCopy;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert("تمام فرمت‌های IPv6 کپی شدند! ✅");
    });
}

// Event listeners
document.getElementById('generateBtn').addEventListener('click', generateIPv6);
document.getElementById('copyBtn').addEventListener('click', copyAll);

// Enter key support
document.getElementById('ipv4Input').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        generateIPv6();
    }
});

document.getElementById('customPrefixInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        generateIPv6();
    }
});
</script>

</body>
</html>
